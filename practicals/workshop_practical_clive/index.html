<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Tade Souaiaia" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Day2 (AM) - prsWorkshop</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Day2 (AM)";
        var mkdocs_page_input_path = "practicals/workshop_practical_clive.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> prsWorkshop
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Pre-Workshop</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../prep_list/">Checklist</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../prep_os/">Operating System</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../prep_terminal/">Terminal Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../prep_software/">Software Installs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../prep_testing/">Testing</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Pre-Workshop Tutorials</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../tut_intro/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tut_bash/">Bash Tutorial</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tut_R/">R Tutorial</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tut_python/">Python Tutorial</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tut_plink/">Plink Tutorial</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Program</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../workshop_practical_paul1/">Day1 (AM)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../workshop_practical_tade/">Day1 (PM)</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Day2 (AM)</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#table-of-contents">Table of contents</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#key-learning-outcomes">Key learning outcomes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#bridgeprs-input-data">BridgePRS input data</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#questions">Questions?</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#passing-arguments-to-bridgeprs-example-run">Passing arguments to BridgePRS - example run</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#fixation-index-fst">Fixation index Fst</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#the-config-files">The *.config files</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#estimating-linkage-disequilibrium-ld">Estimating linkage disequilibrium (LD)</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#questions_1">Questions?</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#bridgeprs-output">BridgePRS output</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#the-models-estimated-by-bridgeprs">The models estimated by BridgePRS</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#questions_2">Questions?</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-bridgeprs-without-target-summary-statistics">Using BridgePRS without target summary statistics</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#questions_3">Questions?</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#question">Question?</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#further-analyses-with-bridgeprs">Further analyses with BridgePRS</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#african-analysis">African analysis</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#qustions">Qustions?</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#analyses-with-other-gwas-summary-statistics">Analyses with other GWAS summary statistics</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#questions_4">Questions?</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#analyses-with-smaller-eur-gwas-summary-statistics">Analyses with smaller EUR GWAS summary statistics</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#questions_5">Questions?</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-bridgeprs-snp-weights">Using BridgePRS SNP weights</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../workshop_practical_paul2/">Day2 (PM)</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Misc</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../misc_linux/">Linux For Windows</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../misc_plink_problem/">Mac Security</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">prsWorkshop</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Program</li>
      <li class="breadcrumb-item active">Day2 (AM)</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/tadesouaiaia/prsWorkshop-website/edit/master/docs/practicals/workshop_practical_clive.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="day-2-morning-practical-cross-ancestry-prs-analyses-using-bridgeprs">Day 2 Morning practical: Cross-ancestry PRS analyses using BridgePRS</h1>
<h2 id="table-of-contents">Table of contents</h2>
<ol>
<li><a href="#key-learning-outcomes">Key learning outcomes</a></li>
<li><a href="#BridgePRS-input-data">BridgePRS input data</a></li>
<li><a href="#passing-arguments-to-bridgePRS---example-run">Passing arguments to BridgePRS - example run</a></li>
<li><a href="#bridgePRS-output">BridgePRS output</a></li>
<li><a href="#using-bridgePRS-without-target-summary-statistics">Using BridgePRS without target summary statistics</a></li>
<li><a href="#further-analyses-with-bridgePRS">Further analyses with BridgePRS</a></li>
<li><a href="#using-bridgePRS-snp-weights">Using BridgePRS SNP weights</a></li>
</ol>
<hr />
<h2 id="key-learning-outcomes">Key learning outcomes</h2>
<p>In the previous lecture we covered the modelling used by
BridgePRS. Here we will use the BridgePRS software to apply the method.
The aim of this practical is to provide you with a basic understanding
and some experience of running BridgePRS software. After completing
this practical, you should be able to:</p>
<ul>
<li>perform cross-population analyses using BridgePRS</li>
<li>understand what input files are required by BridgePRS</li>
<li>set up configuration files to pass arguments to BridgePRS</li>
<li>interpret output from BridgePRS</li>
<li>use BridgePRS output to calculate PRS in unseen samples using SNP weights</li>
</ul>
<p><a href="#top"><a href="#table-of-contents">Back to table of contents</a></a></p>
<h2 id="bridgeprs-input-data">BridgePRS input data</h2>
<p>In the BridgePRS directory there is a data folder which we will use in
this practical. View the data directory
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>$ ls -l data
total 5368
drwxr-xr-x  73 hoggac01  staff     2336 26 Jul 16:00 1000G_sample
-rw-r--r--   1 hoggac01  staff      469 12 Aug 14:35 afr.config
-rw-r--r--   1 hoggac01  staff      469 12 Aug 14:35 eas.config
-rw-r--r--   1 hoggac01  staff      410 12 Aug 14:35 eur.config
drwxr-xr-x   5 hoggac01  staff      160 14 Jul 17:22 pop_AFR
drwxr-xr-x   5 hoggac01  staff      160 14 Jul 17:22 pop_EAS
drwxr-xr-x   5 hoggac01  staff      160  7 Aug 20:30 pop_EUR
-rw-r--r--   1 hoggac01  staff   200376  7 Aug 21:30 qc_snplist.txt
</code></pre></div></p>
<p>The <code>pop_AFR, pop_EAS, pop_EUR</code> folders contain simulated genotype, phenotype and GWAS
summary statistics representative of
Europeans, East Asians and Africans for input to BridgePRS. Each pop_*
folder is split into summary statistics, and
individual level genotype and phenotype folders, e.g.
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>$ ls -l data/pop_AFR/
total 0
drwxr-xr-x  68 hoggac01  staff  2176 14 Jul 17:22 genotypes
drwxr-xr-x   4 hoggac01  staff   128 14 Jul 17:22 phenotypes
drwxr-xr-x  68 hoggac01  staff  2176 12 Aug 11:02 sumstats
</code></pre></div>
Look at each directory e.g. <code>ls pop_AFR/genotypes</code>. There are two sets of summary
statistics in each <code>sumstats</code> folder from the analysis of the same simulated
continuous phenotype, the "half" files were generated using half the
sample size. For computation speed the summary statistics
only have a small subset of SNPs, 19k-20k genomewide, the following
commands count the number of lines in each set of summary statistics
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>zcat data/pop_EAS/sumstats/EAS.chr* | wc -l
zcat data/pop_EUR/sumstats/EUR.chr* | wc -l
zcat data/pop_AFR/sumstats/AFR.chr* | wc -l
</code></pre></div>
or on a Mac
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>gzcat data/pop_EAS/sumstats/EAS.chr* | wc -l
gzcat data/pop_EUR/sumstats/EUR.chr* | wc -l
gzcat data/pop_AFR/sumstats/AFR.chr* | wc -l
</code></pre></div>
<code>zcat</code>/<code>gzcat</code> are used as the files are gzipped. <code>|</code> "pipes" the
output to <code>wc -l</code> which counts the number of lines.</p>
<p>Results in these files are only shown for SNPs with MAF&gt;0 and are a
random subset of HapMap SNPs.</p>
<h3 id="questions">Questions?</h3>
<ul>
<li>Which population has the most polymorphic SNPs?</li>
<li>Which population has the least polymorphic SNPs?</li>
<li>Do you think there is a bias in the SNP ascertainment?</li>
<li>Which population would you expect to have the most polymorphic SNPs
  if SNPs were ascertained randomly from 1000G?</li>
</ul>
<p>Take a look a look at the files, e.g.
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>zcat data/pop_AFR/sumstats/AFR.chr19.glm.linear.gz | head 
zcat data/pop_AFR/sumstats/AFR_half.chr19.glm.linear.gz | head 
</code></pre></div>
again use <code>gzcat</code> on a Mac.</p>
<p>In the OBS_CT column you'll see can that the "_half" summary
statistics files have half the sample size, 10,000 compared to 20,000
for the EAS and AFR populations and 40,000 compared to 80,000 for the
EUR population. The same SNPs are contained in each set of summary statistics.</p>
<p>The <code>phenotypes</code> folders has two files: "test" and "validation" with
IDs, the outcome phenotype and covariates. "Test" data is used to
estimate the PRS and "validation" data is used only to assess model performance,
it is not used to estimate the PRS.</p>
<p>The <code>genotypes</code> folders are in <code>plink</code> binary format and are split by
chromosome. These folders contain the genetic data for both test and
validation individuals in the phenotypes folder.</p>
<p>Test data is only used for individuals with both genotype and phenotype
information. Similarly model performance metrics is only used validation samples with both
genotype and phenotype information, however, predictions are generated
for all validation samples with genotype data.</p>
<p><a href="#top"><a href="#table-of-contents">Back to table of contents</a></a></p>
<h2 id="passing-arguments-to-bridgeprs-example-run">Passing arguments to BridgePRS - example run</h2>
<p>Example run of BridgePRS:
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>./bridgePRS pipeline go -o out/ --config_files data/eas.config data/eur.config --fst 0.11 --phenotype y --cores 4 --restart
</code></pre></div>
Arguments can be passed to BridgePRS both directly on the command-line and in
config files. The command-line arguments used above are:
* <code>-o</code>  Output folder
* <code>--config_files</code>  Configuration files, see below
* <code>--fst</code> Fst between the base and target populations used in the analysis, used to specify a prior
distribution. The Fst between EAS and EUR is 0.11
* <code>--phenotype</code>  The column label of the phenotype in the test and validation
files, e.g. <code>EAS_valid.dat</code>
* <code>--cores</code>  The number of cores used in the analysis.</p>
<h4 id="fixation-index-fst">Fixation index Fst</h4>
<p>Fst is a measure of genetic distance between two populations. Details on the definition and calculation of Fst can be found on <a href="https://en.wikipedia.org/wiki/Fixation_index">Wikipedia</a>. Given genetic data from two populations Fst can be calculated in <code>plink</code>, for details see https://www.cog-genomics.org/plink/1.9/basic_stats#fst.</p>
<h3 id="the-config-files">The *.config files</h3>
<p>config files are a neat way to store population
specific arguments. For a standard two population analysis
two config files are required, by default the first config file is for the target
population and the second is for the base population. <br />
.config files tell BridgePRS where to find the required input files 
and the column headers of the summary statistics files for a
population data set, take a look, e.g.
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>cat data/eas.config 
POP=EAS
LDPOP=EAS
LD_PATH=1000G_sample
SUMSTATS_PREFIX=pop_EAS/sumstats/EAS.chr
SUMSTATS_SIZE=20000
#SUMSTATS_PREFIX=pop_EAS/sumstats/EAS_half.chr
#SUMSTATS_SIZE=10000
SUMSTATS_SUFFIX=.glm.linear.gz
GENOTYPE_PREFIX=pop_EAS/genotypes/chr
PHENOTYPE_FILE=pop_EAS/phenotypes/EAS_test.dat  
VALIDATION_FILE=pop_EAS/phenotypes/EAS_valid.dat 
SNP_FILE=qc_snplist.txt
SSF-P=P
SSF-SNPID=ID
SSF-BETA=BETA
SSF-REF=REF
SSF-ALT=A1
</code></pre></div>
This config file contains all possible arguments that can be used in
config files. config files use the same argument names as the
command-line arguments but in uppercase, and use "=" instead of a space
between the argument name and the argument being passed.</p>
<p>The <code>POP</code> argument simply labels the population used in this .config
file for output.</p>
<p>A full list of arguments can be found <a href="https://www.bridgeprs.net/guide_args/">here</a>.</p>
<h3 id="estimating-linkage-disequilibrium-ld">Estimating linkage disequilibrium (LD)</h3>
<p>BridgePRS requires individual level genetic data in <code>plink</code> binary
format to estimate linkage disequilibrium (LD) in the populations
which produced the GWAS summary statistics. The genotype test and
validation data could be used, e.g. data here
<code>pop_EUR/genotypes/</code>. If these data are small, less than 500 samples, or
are not representative of the GWAS population, we provide 1000 Genomes
(1000G) data to estimate LD. Suitable 1000G data for this analysis
is in the 1000G_sample folder
for the small subset of SNPs used in these examples.</p>
<p>The <code>.config</code> files point to
the folder with reference LD data by the <code>LD_PATH</code> argument in the
config file. LD reference data is available for the five 1000G super populations (abbreviations
required to use in brackets): East Asian (EAS), South Asian (SAS),
European (Eur), African (AFR) and American (AMR).</p>
<p><strong>For real data analyses 1000G reference data for larger subsets of SNPs can be
downloaded <a href="https://www.bridgeprs.net">here</a></strong></p>
<h3 id="questions_1">Questions?</h3>
<ul>
<li>Can you work out what the other command line arguments are doing?</li>
<li>Can you work out what the other config file arguments are doing?</li>
</ul>
<p><a href="#top"><a href="#table-of-contents">Back to table of contents</a></a></p>
<h2 id="bridgeprs-output">BridgePRS output</h2>
<p>The main output is in the folder <code>out/prs-combined_EAS-EUR/</code>. First
view the output summary plot
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>evince  out/prs-combined_EAS-EUR/bridgePRS-combo.pdf
</code></pre></div>
on a Mac use <code>open</code> instead of <code>evince</code>.</p>
<p>The barplot at the top shows the variance explained (R2) by the
four PRS models BridgePRS estimates. The weighted model is BridgePRS
estimated "best" PRS.</p>
<h3 id="the-models-estimated-by-bridgeprs">The models estimated by BridgePRS</h3>
<p>The three separate target population PRS estimated by BridgePRS are:
* <strong>Stage 2 model</strong> -- estimated using target population data with prior effect-size distribution from the base (European) population
* <strong>Stage 1 model</strong> -- estimated using only the target (Non-European) data
* <strong>Stage1+2 model</strong> -- estimated using both stage 1 and stage 2 models</p>
<p>Each of these three models are given weights corresponding to how well
they fit the test data. These weights are then used to combine the PRS
to give the single weighted combined PRS.</p>
<p>The weighted combined PRS should typically be used.  The models,
stage1, stage2 and stage1+2, should not be used unless users have a
strong prior belief that a particular model is better. The hypotheses
of the three models are:
* <strong>Stage 2 model</strong> reflects the belief that the target population GWAS is only
  informative when used with the base population GWAS
* <strong>Stage 1 model</strong> reflects the belief that the target population GWAS is
  informative and the base population GWAS gives no addition
  information.
* <strong>Stage 1+2 model</strong> reflects the belief both the base and target population
  GWAS contribute independent information</p>
<p>Look at the following output file
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>cat out/prs-combined_EAS-EUR/EAS_weighted_combined_var_explained.txt
</code></pre></div></p>
<h3 id="questions_2">Questions?</h3>
<ul>
<li>Which plot in the summary plot was constructed from this output
  file?</li>
<li>How do the Manhattan plots of the base and target populations
  compare?</li>
</ul>
<p><code>EAS_weighted_combined_preds.dat</code> has PRS predictions for samples in
the validation data using all four models: stage1, stage2, stage1+2
and weighted. <code>EAS_weighted_combined_snp_weights.dat</code> has the SNP
weights for the combined to allow this model to be applied to other
samples.</p>
<p><a href="#top"><a href="#table-of-contents">Back to table of contents</a></a></p>
<h2 id="using-bridgeprs-without-target-summary-statistics">Using BridgePRS without target summary statistics</h2>
<p>Often GWAS summary statistics are only available in one
population. BridgePRS can use these summary statistics and optimise
them to estimate a PRS for another target population given individual
level from the target population. Here is an example using the
<code>data/eur_eas.config</code> config file
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>./bridgePRS prs-single run -o out_single/ --config_file data/eur_eas.config --phenotype y --cores 4
</code></pre></div>
Look at <code>data/eur_eas.config</code>.</p>
<h3 id="questions_3">Questions?</h3>
<ul>
<li>What GWAS summary data is used?</li>
<li>What test data is used for model optimisation?</li>
<li>What validation data is used?</li>
</ul>
<p>Results of interest are written to the folder
<code>out_single/prs-single_EAS/quantify/</code>. Model performance is shown in
the file <code>EAS_quantify_var_explained.txt</code> and plotted in ....</p>
<p>See how these results compare with the previous analysis which
included EAS GWAS summary statistics.
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>cat out_single/prs-single_EAS/quantify/EAS_quantify_var_explained.txt
cat out/prs-combined_EAS-EUR/EAS_weighted_combined_var_explained.txt
</code></pre></div>
This single summary statistic analysis is equivalent to the stage 2
analysis previously but with all the weight on the EUR prior.</p>
<h3 id="question">Question?</h3>
<ul>
<li>How does prediction using only EUR summary statistics compare with
those which include information from the EAS summary statistics?</li>
</ul>
<p><a href="#top"><a href="#table-of-contents">Back to table of contents</a></a></p>
<h2 id="further-analyses-with-bridgeprs">Further analyses with BridgePRS</h2>
<h3 id="african-analysis">African analysis</h3>
<p>Run BridgePRS again to estimate PRS in Africans using
<code>afr.config</code>. Note, you should also change the command line <code>fst</code>
argument to match the Fst between Africans and Europeans, use 0.15.</p>
<h3 id="qustions">Qustions?</h3>
<ul>
<li>Which population, EAS or AFR, has the best prediction?</li>
<li>What are the reasons for the differences in prediction between the populations?</li>
</ul>
<h3 id="analyses-with-other-gwas-summary-statistics">Analyses with other GWAS summary statistics</h3>
<p>For each population the config files contain commented out links to GWAS summary
statistics of the same phenotype using half the same size: 40k for EUR
and 10k for both EAS and AFR.</p>
<p>Edit <code>eas.config</code> to use the EAS 10k
GWAS summary statistics. To run the analysis write results to a new
output directory e.g. <code>out_half_target</code>. Run the similar analysis for
African samples by editing  <code>afr.config</code>. Compare with previous results using the
10k EAS and EAS GWAS. Compare EAS and AFR results.</p>
<p>Check you've run the analyses using the correct GWAS summary
statistics, e.g.
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>less less out_half_target/logs/bridgePRS.eas-eur.pipeline.go.log
less less out_half_target/logs/bridgePRS.afr-eur.pipeline.go.log
</code></pre></div>
or
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>grep Sumstats out_half_target/logs/bridgePRS.eas-eur.pipeline.go.log
grep Sumstats out_half_target/logs/bridgePRS.afr-eur.pipeline.go.log
</code></pre></div></p>
<p>If you have made a mistake, correct and run again using the
<code>--restart</code> flag which deletes the previously generated results.</p>
<h3 id="questions_4">Questions?</h3>
<ul>
<li>How has using the less well powered EAS and AFR GWAS affected the predictive
  accuracy of the BridgePRS models?</li>
<li>How do AFR and EAS results compare?</li>
</ul>
<h4 id="analyses-with-smaller-eur-gwas-summary-statistics">Analyses with smaller EUR GWAS summary statistics</h4>
<p>Run BridgePRS analysis using using the 40k EUR GWAS (use <code>EUR_half</code>) as base and 20k EAS GWAS as target.
You will need to edit <code>eur.config</code> and <code>eas.config</code> to use the correct summary statistics and pass the
correct GWAS sample size. Write to results to a new directory e.g. <code>out_half_eur</code>.
Run the equivalent analysis for AFR.</p>
<h3 id="questions_5">Questions?</h3>
<ul>
<li>How has using the less well powered EUR GWAS affected the predictive
  accuracy of the BridgePRS models?</li>
<li>How do AFR and EAS results compare?</li>
</ul>
<p><a href="#top"><a href="#table-of-contents">Back to table of contents</a></a></p>
<h2 id="using-bridgeprs-snp-weights">Using BridgePRS SNP weights</h2>
<p>The SNP weights in <code>EAS_weighted_combined_snp_weights.dat</code> can be used to make
predictions in other samples for which we have overlapping genotype data. We demonstrate
this using <code>plink</code> and data in <code>data/pop_EAS/genotypes/</code>. The genotype data is split
by chromosome, therefore predictions are estimated for each chromosome separately and
then combined. The following bash commands estimate the per chromosome predictions using plink,
we first make a directory to write these predictions to
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>mkdir out/preds
for chr in {1..22}
do
    plink --score out/prs-combined_EAS-EUR/EAS_weighted_combined_snp_weights.dat 1 2 4 sum \
          --bfile data/pop_EAS/genotypes/chr$chr \
          --out out/preds/EAS_chr$chr
done
</code></pre></div>
We then read these predictions into R to combine
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>R
library(data.table)
tmp &lt;- fread(paste0(&#39;out/preds/EAS_chr1.profile&#39;))
pred &lt;- data.frame( tmp$IID, tmp$SCORESUM )
colnames(pred) &lt;- c(&#39;IID&#39;,&#39;Score&#39;)
for( chr in 2:22 ){
    tmp &lt;- fread(paste0(&#39;out/preds/EAS_chr&#39;,chr,&#39;.profile&#39;))
    pred[,2] &lt;- pred[,2] + tmp$SCORESUM
}

# Check predictions are the same as those produced directly by BridgePRS
valid &lt;- fread(&#39;out/prs-combined_EAS-EUR/EAS_weighted_combined_preds.dat&#39;)
# Match IDs
ptr &lt;- match( valid$IID, pred$IID )
plot( pred$Score[ptr], valid$Weighted, main=&quot;Individual PRS&quot;
      xlab=&quot;PRS estimated by BridgePRS&quot;,
      ylab=&quot;PRS re-estimated from SNP weights&quot; )
</code></pre></div>
Predictions are the same +/- rounding error and a constant.</p>
<p><a href="#top"><a href="#table-of-contents">Back to table of contents</a></a></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../workshop_practical_tade/" class="btn btn-neutral float-left" title="Day1 (PM)"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../workshop_practical_paul2/" class="btn btn-neutral float-right" title="Day2 (PM)">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/tadesouaiaia/prsWorkshop-website" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../workshop_practical_tade/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../workshop_practical_paul2/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      <script src="../../javascripts/details.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
